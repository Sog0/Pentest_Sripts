#!/usr/bin/env python
import scapy.all as scapy
import scapy.layers.l2
from scapy.layers.l2 import *
import optparse

parser = optparse.OptionParser()
parser.add_option("-t","--target",dest= "ip" ,help ="target range of ip or just ip")
(options, arguments) = parser.parse_args()
def scan(ip):
    arp_packet = Ether(dst="ff:ff:ff:ff:ff:ff") / ARP(pdst=ip)
    answered = srp(arp_packet, timeout=3, verbose=False)[0]
    list_dict = []
    for answer in answered:
        temp_dict = {"ip": answer[1].psrc, "mac": answer[1].hwsrc}
        list_dict.append(temp_dict)
    return list_dict


def print_res_scan(scan_list):
    default_spaces = len(scan_list[0]["ip"])
    header_len = (default_spaces * 2) - 2
    header = "IP"
    for i in range(header_len):
        header += " "
    print(header + "MAC")
    print("---------------------------------------")
    for answer in scan_list:
        print_result = answer["ip"]
        spaces = default_spaces + (default_spaces - len(answer["ip"]))
        for i in range(spaces):
            print_result += " "
        print_result += answer["mac"]
        print(print_result)


result = scan(str(options.ip))
print_res_scan(result)
