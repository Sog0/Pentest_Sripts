#!/usr/bin/env python

import os
import subprocess
import random
import optparse
import re

parser = optparse.OptionParser()
parser.add_option("-i", "--interface", dest="interface", help="Interface which mac address you wanna change")
parser.add_option("-m", "--mac", dest="new_mac", help="mac address")
(options, arguments) = parser.parse_args()
interface = str(options.interface)
mac_address = str(options.new_mac)


def generate_mac():
    mac = ""
    for i in range(6):
        if i == 5:
            mac += str(random.randint(10, 30))
        else:
            mac += str(random.randint(10, 40)) + ":"
    return mac


def pick_interface():
    intrf = os.listdir('/sys/class/net')
    for i in intrf:
        print(i)
    inf = str(input("Choose interface: "))
    return inf


def change_mac(inf, mac):
    if (mac == "" or mac == "None") or (inf == "" or inf == "None"):
        if mac == "" or mac == "None": mac = generate_mac()
        if inf == "" or inf == "None": inf = pick_interface()
    check = False
    for i in os.listdir('/sys/class/net'):
        if inf == i:
            check = True
            break
    if check:
        print("[+] YOUR NEW MAC ADDRESS FOR " + inf + " WILL BE -> " + mac)
        subprocess.call("ifconfig " + inf + " down", shell=True)
        subprocess.call("ifconfig " + inf + " hw ether " + str(mac), shell=True)
        subprocess.call("ifconfig " + inf + " up", shell=True)
        outputy = subprocess.check_output(["ifconfig", inf])
        search = re.search(r"\w\w:\w\w:\w\w:\w\w:\w\w:\w\w", outputy.decode('utf8'))
        if search.group(0) == mac:
            print("[+] MAC ADDRESS HAS BEEN CHANGED SUCCESSFULLY FOR " + inf)
        else:
            print("[-] PROCESS FAILED")
            print("[+] PROCESS RESTARTING")
            mac = generate_mac()
            change_mac(inf, mac)
    else:
        print("[-] INVALID INTERFACE")
        inf = pick_interface()
        change_mac(inf, mac)


change_mac(interface, mac_address)
